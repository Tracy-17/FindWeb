<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<!--依靠以下名称映射，记得修改：-->
<mapper namespace="com.shu.find.mapper.QuestionExtMapper">
    <resultMap id="BaseResultMap" type="com.shu.find.model.Question">
        <constructor>
            <idArg column="id" javaType="java.lang.Integer" jdbcType="INTEGER" />
            <arg column="title" javaType="java.lang.String" jdbcType="VARCHAR" />
            <arg column="tag" javaType="java.lang.String" jdbcType="VARCHAR" />
            <arg column="creator" javaType="java.lang.Integer" jdbcType="INTEGER" />
            <arg column="view_count" javaType="java.lang.Integer" jdbcType="INTEGER" />
            <arg column="comment_count" javaType="java.lang.Integer" jdbcType="INTEGER" />
            <arg column="like_count" javaType="java.lang.Integer" jdbcType="INTEGER" />
            <arg column="coll_count" javaType="java.lang.Integer" jdbcType="INTEGER" />
            <arg column="gmt_create" javaType="java.lang.Long" jdbcType="BIGINT" />
            <arg column="gmt_modify" javaType="java.lang.Long" jdbcType="BIGINT" />
        </constructor>
    </resultMap>
    <resultMap id="ResultMapWithBLOBs" type="com.shu.find.model.Question" extends="BaseResultMap">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Fri Dec 13 01:18:17 CST 2019.
        -->
        <result column="description" property="description" jdbcType="LONGVARCHAR"/>
    </resultMap>
    <!-- 通过观察原xml文件发现parameterType为question时，不需要record取值，故去掉viewCount前的record. -->
    <update id="incView" parameterType="com.shu.find.model.Question">
        <!--
         12.13：更新阅读量
        -->
        update question
        set
        view_count = view_count+#{viewCount,jdbcType=INTEGER}
        where id=#{id}
    </update>
    <update id="incComment" parameterType="com.shu.find.model.Question">
        <!--
         12.13：更新评论数
        -->
        update question
        set
        comment_count = comment_count+#{commentCount,jdbcType=INTEGER}
        where id=#{id}
    </update>
    <update id="incCollection" parameterType="com.shu.find.model.Question">
        <!--
         4.23：更新收藏数
        -->
        update question
        set
        coll_count = coll_count+#{collCount,jdbcType=INTEGER}
        where id=#{id}
    </update>
    <!--  sql正则表达查找tag-->
    <select id="selectRelated" resultMap="BaseResultMap" parameterType="com.shu.find.model.Question">
        select * from question where id!=#{id} and tag regexp #{tag}
    </select>
    <!--  search不为空时，搜索标题（返回值resultType可以写Integer类型？？？）
    12.20：修改为resultType后，首页不展示description的问题竟然自动修复了。。。神奇
    添加and search != ''后，修复search为空的bug-->
    <select id="countBySearch" resultType="java.lang.Integer" parameterType="com.shu.find.model.Question">
        select count(*) from question
        <where>
            <if test="search != null and search != ''">
                and title regexp #{search}
            </if>
        </where>
    </select>
    <!--  -->
    <select id="selectBySearch" resultMap="BaseResultMap" parameterType="com.shu.find.model.Question">
        select * from question
        <where>
            <if test="search != null and search != ''">
                and title regexp #{search}
            </if>
        </where>
        order by gmt_create desc
    </select>

</mapper>